<!doctype html>
<html>
<head>
    <title>Lista de bebés</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css"> <!-- load bootstrap css -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css"> <!-- load fontawesome -->
		<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>
		<script src="/js/baby-diary.js"></script>
		<script src="/js/bootstrap-slider.js"></script>
		<script type="text/javascript" src="/js/moment/min/moment.min.js"></script>
		<script type="text/javascript" src="/js/moment/locale/es.js"></script>
		<script src="/js/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
  	<link rel="stylesheet" href="/js/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />
		<link rel="stylesheet" href="/css/baby-diary.css"></link>
		<link rel="stylesheet" href="/css/bootstrap-slider.css"></link>
		
		<script type="text/javascript" src="/js/d3.min.js""></script>
		<script type="text/javascript" src="/js/nv.d3.min.js""></script>
		<link rel="stylesheet" href="/css/nv.d3.css"></link>
    <style>
        body        { padding-top:80px; }
				
				.discreteBar {
					fill: steelblue;
				}
				
				.bar:hover {
					fill: brown;
				}
				
				.axis {
					font: 10px sans-serif;
				}
				
				.axis path,
				.axis line {
					fill: none;
					stroke: #000;
					shape-rendering: crispEdges;
				}
				
				.x.axis path {
					display: none;
				}
    </style>
</head>
<body>
<div class="container">
	<% include ../partials/topMenu %>
	<% if (messages.info) { %>
		<div class="alert alert-success alert-dismissible" role="alert">
			<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<%= messages.info %>
		</div>
	<% } %>
	<% if (messages.error) { %>
		<div class="alert alert-danger alert-dismissible" role="alert">
			<button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<%= messages.error %>
		</div>
	<% } %>
	
	<%- include('../partials/eventSelector', {baby: null}); -%>
		
	<% for(var i=0; i<babies.length; i++) {%>
		<div class="chart">
			<h3 class="chart-title"></h3>
			<svg><rect x="0" y="0" width="100" height="100" fill="none" class="bk"></rect><g transform="translate(-20,-20)"><path d="M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z" fill="#92c3e7"><animateTransform attributeName="transform" type="rotate" from="90 50 50" to="0 50 50" dur="1s" repeatCount="indefinite"></animateTransform></path></g><g transform="translate(20,20) rotate(15 50 50)"><path d="M79.9,52.6C80,51.8,80,50.9,80,50s0-1.8-0.1-2.6l-5.1-0.4c-0.3-2.4-0.9-4.6-1.8-6.7l4.2-2.9c-0.7-1.6-1.6-3.1-2.6-4.5 L70,35c-1.4-1.9-3.1-3.5-4.9-4.9l2.2-4.6c-1.4-1-2.9-1.9-4.5-2.6L59.8,27c-2.1-0.9-4.4-1.5-6.7-1.8l-0.4-5.1C51.8,20,50.9,20,50,20 s-1.8,0-2.6,0.1l-0.4,5.1c-2.4,0.3-4.6,0.9-6.7,1.8l-2.9-4.1c-1.6,0.7-3.1,1.6-4.5,2.6l2.1,4.6c-1.9,1.4-3.5,3.1-5,4.9l-4.5-2.1 c-1,1.4-1.9,2.9-2.6,4.5l4.1,2.9c-0.9,2.1-1.5,4.4-1.8,6.8l-5,0.4C20,48.2,20,49.1,20,50s0,1.8,0.1,2.6l5,0.4 c0.3,2.4,0.9,4.7,1.8,6.8l-4.1,2.9c0.7,1.6,1.6,3.1,2.6,4.5l4.5-2.1c1.4,1.9,3.1,3.5,5,4.9l-2.1,4.6c1.4,1,2.9,1.9,4.5,2.6l2.9-4.1 c2.1,0.9,4.4,1.5,6.7,1.8l0.4,5.1C48.2,80,49.1,80,50,80s1.8,0,2.6-0.1l0.4-5.1c2.3-0.3,4.6-0.9,6.7-1.8l2.9,4.2 c1.6-0.7,3.1-1.6,4.5-2.6L65,69.9c1.9-1.4,3.5-3,4.9-4.9l4.6,2.2c1-1.4,1.9-2.9,2.6-4.5L73,59.8c0.9-2.1,1.5-4.4,1.8-6.7L79.9,52.6 z M50,65c-8.3,0-15-6.7-15-15c0-8.3,6.7-15,15-15s15,6.7,15,15C65,58.3,58.3,65,50,65z" fill="#dba3c3"><animateTransform attributeName="transform" type="rotate" from="0 50 50" to="90 50 50" dur="1s" repeatCount="indefinite"></animateTransform></path></g></svg>
		</div>
	<% } %>
	<div class="clearer"></div>
</div>
<script>
	$(function(){
		var aWeekAgo = new Date();
		aWeekAgo.setHours(0,0,0,0);
		aWeekAgo = new Date(aWeekAgo.getTime() - 1000 * 60 * 60 * 24 * 7); 
		var from = ''+aWeekAgo.getFullYear()+(aWeekAgo.getMonth()+1)+aWeekAgo.getDate();
		var to = ''+new Date().getFullYear()+(new Date().getMonth()+1)+new Date().getDate();
		var result = $.get('/babies/getAggregatedData?from='+from+'&to='+to);

		result.success(function(data){
			$('.chart svg').html('');
			$(data).each(function(i,graph){
				if(graph){
					var datum = [graph];
					var elem = $(".chart h3.chart-title")[i]; 
					$(elem).text(graph.key);
					
					nv.addGraph(function() {
						var chart = nv.models.discreteBarChart()
								.x(function(d) { return d.label })    //Specify the data accessors.
								.y(function(d) { return d.value })
								.staggerLabels(true)    //Too many bars and not enough room? Try staggering labels.
								.tooltips(false)        //Don't show tooltips
								.showValues(false)       //...instead, show the bar value right on top of each bar.
								;

						d3.select(d3.selectAll('.chart svg')[0][i])
								.datum(datum)
								.call(chart);
					
						nv.utils.windowResize(chart.update);
					
						return chart;
					});
				}else{
					var elem = $(".chart h3.chart-title")[i];
					$(elem).text('No hay datos de la última semana.');
				}
			});
		});
	});
</script>
</body>
</html>